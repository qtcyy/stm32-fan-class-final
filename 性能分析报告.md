# æ™ºèƒ½é£æ‰‡æ§åˆ¶ç³»ç»Ÿæ€§èƒ½åˆ†ææŠ¥å‘Š

## ğŸ“Š **æ‰€æœ‰ç”¨åˆ°çš„å‡½æ•°åˆ—è¡¨**

### **1. ç³»ç»Ÿåˆå§‹åŒ–å‡½æ•°**

- `delay_init(168)` - å»¶æ—¶ç³»ç»Ÿåˆå§‹åŒ–
- `key_init()` - æŒ‰é”®åˆå§‹åŒ–
- `key_interrupt_init()` - æŒ‰é”®ä¸­æ–­åˆå§‹åŒ–
- `lcd_init(FAN1)` - LCD æ˜¾ç¤ºåˆå§‹åŒ–
- `infrared_init()` - çº¢å¤–ä¼ æ„Ÿå™¨åˆå§‹åŒ–
- `rgb_init()` - RGB ç¯åˆå§‹åŒ–
- `buzzer_init()` - èœ‚é¸£å™¨åˆå§‹åŒ–
- `led_init()` - LED æŒ‡ç¤ºç¯åˆå§‹åŒ–
- `usart_init(115200)` - ä¸²å£é€šä¿¡åˆå§‹åŒ–
- `htu21d_init()` - æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨åˆå§‹åŒ–
- `fan_pwm_init(50000-1, 336-1)` - é£æ‰‡ PWM æ§åˆ¶åˆå§‹åŒ–

### **2. ä¼ æ„Ÿå™¨æ•°æ®è¯»å–å‡½æ•°**

- `htu21d_t()` - è¯»å–æ¸©åº¦æ•°æ®
- `htu21d_h()` - è¯»å–æ¹¿åº¦æ•°æ®
- `get_infrared_status()` - è¯»å–çº¢å¤–ä¼ æ„Ÿå™¨çŠ¶æ€

### **3. æ˜¾ç¤ºæ§åˆ¶å‡½æ•°**

- `LCDDrawFont16_Next()` - LCD å­—ä½“æ˜¾ç¤ºå‡½æ•°
- `get_centered_x()` - è‡ªå®šä¹‰æ–‡å­—å±…ä¸­è®¡ç®—å‡½æ•°
- `update_display()` - è‡ªå®šä¹‰æ˜¾ç¤ºæ›´æ–°å‡½æ•°

### **4. é€šä¿¡å‡½æ•°**

- `strncmp()` - å­—ç¬¦ä¸²æ¯”è¾ƒ
- `sprintf()` - å­—ç¬¦ä¸²æ ¼å¼åŒ–
- `printf()` - ä¸²å£è¾“å‡º
- `strlen()` - å­—ç¬¦ä¸²é•¿åº¦è®¡ç®—
- `clean_usart()` - æ¸…ç©ºä¸²å£ç¼“å†²åŒº

### **5. æ§åˆ¶è¾“å‡ºå‡½æ•°**

- `fan_pwm_control()` - é£æ‰‡ PWM æ§åˆ¶
- `rgb_ctrl()` - RGB æŒ‡ç¤ºç¯æ§åˆ¶
- `led_control()` - LED æŒ‡ç¤ºç¯æ§åˆ¶
- `buzzer_tweet()` - èœ‚é¸£å™¨æ§åˆ¶

### **6. å»¶æ—¶å‡½æ•°**

- `delay_ms()` - æ¯«ç§’çº§å»¶æ—¶
- `delay_count()` - è‡ªå®šä¹‰è®¡æ•°å»¶æ—¶

### **7. è‡ªå®šä¹‰åŠŸèƒ½å‡½æ•°**

- `send_human_status()` - å‘é€äººä½“æ£€æµ‹çŠ¶æ€
- `send_system_status()` - å‘é€ç³»ç»ŸçŠ¶æ€
- `check_uart_command()` - æ£€æŸ¥ä¸²å£å‘½ä»¤
- `check_human_presence()` - æ£€æŸ¥äººä½“å­˜åœ¨
- `auto_control()` - è‡ªåŠ¨æ§åˆ¶é€»è¾‘

---

## âš¡ **æ€§èƒ½åˆ†æ**

### **ğŸ”´ æ€§èƒ½ç“¶é¢ˆç‚¹**

#### **1. ä¸»å¾ªç¯é¢‘ç‡è¿‡é«˜**

```c
while(1) {
    // ä¸»å¾ªç¯æ‰§è¡Œé¢‘ç‡çº¦1000Hz (1msä¸€æ¬¡)
    delay_ms(1);
}
```

- **é—®é¢˜**: 1ms çš„ä¸»å¾ªç¯å¯¹ MCU èµ„æºæ¶ˆè€—è¾ƒå¤§
- **å»ºè®®**: è°ƒæ•´ä¸º 5-10msï¼Œå‡å°‘ CPU å ç”¨ç‡

#### **2. LCD æ›´æ–°é¢‘ç‡è¿‡é«˜**

```c
if (no_motion_timer % 100 == 0) {
    update_display(current_temp, current_humi);  // æ¯100msæ›´æ–°ä¸€æ¬¡
}
```

- **é—®é¢˜**: LCD æ›´æ–°æ˜¯è€—æ—¶æ“ä½œï¼Œæ¯ 100ms æ›´æ–°è¿‡äºé¢‘ç¹
- **å»ºè®®**: æ”¹ä¸º 500ms-1s æ›´æ–°ä¸€æ¬¡

#### **3. æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨è¯»å–é¢‘ç‡é«˜**

```c
// ç³»ç»Ÿå…³é—­æ—¶ä»åœ¨è¯»å–
send_system_status(htu21d_t(), htu21d_h());  // æ¯3msæ‰§è¡Œä¸€æ¬¡
```

- **é—®é¢˜**: I2C é€šä¿¡è€—æ—¶ï¼Œé¢‘ç¹è¯»å–å½±å“å“åº”é€Ÿåº¦
- **å»ºè®®**: ç¼“å­˜æ•°æ®ï¼Œé™ä½è¯»å–é¢‘ç‡

#### **4. å­—ç¬¦ä¸²å¤„ç†å¼€é”€**

```c
int get_centered_x(const char *text) {
    // æ¯æ¬¡LCDæ˜¾ç¤ºéƒ½è¦è®¡ç®—ï¼ŒåŒ…å«å¾ªç¯éå†
    for (int i = 0; i < text_len; i++) { ... }
}
```

- **é—®é¢˜**: æ¯æ¬¡æ˜¾ç¤ºéƒ½é‡æ–°è®¡ç®—å±…ä¸­ä½ç½®
- **å»ºè®®**: é¢„è®¡ç®—å¸¸ç”¨å­—ç¬¦ä¸²çš„å±…ä¸­ä½ç½®

### **ğŸŸ¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**

#### **1. æ—¶é—´ç®¡ç†ä¼˜åŒ–**

```c
// å»ºè®®çš„ä¼˜åŒ–æ–¹æ¡ˆ
#define MAIN_LOOP_PERIOD    10    // ä¸»å¾ªç¯10ms
#define LCD_UPDATE_PERIOD   500   // LCDæ›´æ–°500ms
#define SENSOR_READ_PERIOD  100   // ä¼ æ„Ÿå™¨è¯»å–100ms
#define STATUS_OUTPUT_PERIOD 1000 // çŠ¶æ€è¾“å‡º1ç§’
```

#### **2. å†…å­˜ä½¿ç”¨ä¼˜åŒ–**

- **æ ˆå†…å­˜**: å½“å‰çº¦ 200 å­—èŠ‚ï¼ˆå¤šä¸ªå±€éƒ¨ char æ•°ç»„ï¼‰
- **å…¨å±€å˜é‡**: çº¦ 50 å­—èŠ‚ï¼Œä½¿ç”¨åˆç†
- **å»ºè®®**: å‡å°‘å±€éƒ¨å¤§æ•°ç»„çš„ä½¿ç”¨

#### **3. ä¸­æ–­å“åº”ä¼˜åŒ–**

```c
delay_count(50);  // å½“å‰50msé˜²æŠ–æ—¶é—´è¿‡é•¿
// å»ºè®®æ”¹ä¸º
delay_count(10);  // 10msè¶³å¤Ÿé˜²æŠ–ï¼Œæé«˜å“åº”é€Ÿåº¦
```

### **ğŸŸ¢ æ€§èƒ½ä¼˜åŠ¿**

#### **1. æ¨¡å—åŒ–è®¾è®¡å¥½**

- å„åŠŸèƒ½æ¨¡å—åˆ†ç¦»æ¸…æ™°
- ä»£ç å¯ç»´æŠ¤æ€§é«˜
- ä¾¿äºæ€§èƒ½è°ƒä¼˜

#### **2. çŠ¶æ€æœºè®¾è®¡åˆç†**

- ç³»ç»Ÿå¼€å…³çŠ¶æ€æ§åˆ¶å¾—å½“
- æ¨¡å¼åˆ‡æ¢é€»è¾‘æ¸…æ™°
- å‡å°‘ä¸å¿…è¦çš„å¤„ç†

#### **3. ç¡¬ä»¶èµ„æºåˆ©ç”¨åˆç†**

- ä¸­æ–­æ–¹å¼å¤„ç†æŒ‰é”®ï¼Œå“åº”åŠæ—¶
- PWM æ§åˆ¶é£æ‰‡ï¼Œæ§åˆ¶ç²¾åº¦é«˜
- RGB/LED çŠ¶æ€æŒ‡ç¤ºç›´è§‚

---

## ğŸ“ˆ **æ€§èƒ½è¯„ä¼°ç»“æœ**

| æ€§èƒ½æŒ‡æ ‡         | å½“å‰çŠ¶æ€ | ä¼˜åŒ–ç›®æ ‡ | æ”¹è¿›æ–¹æ¡ˆ        |
| ---------------- | -------- | -------- | --------------- |
| **ä¸»å¾ªç¯é¢‘ç‡**   | 1000Hz   | 100Hz    | è°ƒæ•´å»¶æ—¶ä¸º 10ms |
| **LCD æ›´æ–°é¢‘ç‡** | 10Hz     | 2Hz      | 500ms æ›´æ–°ä¸€æ¬¡  |
| **æŒ‰é”®å“åº”æ—¶é—´** | 50ms     | 10ms     | å‡å°‘é˜²æŠ–å»¶æ—¶    |
| **æ¸©åº¦è¯»å–é¢‘ç‡** | 333Hz    | 10Hz     | ç¼“å­˜ä¼ æ„Ÿå™¨æ•°æ®  |
| **å†…å­˜ä½¿ç”¨ç‡**   | ä¸­ç­‰     | ä½       | ä¼˜åŒ–å­—ç¬¦ä¸²å¤„ç†  |
| **CPU å ç”¨ç‡**   | é«˜       | ä¸­       | é™ä½å¾ªç¯é¢‘ç‡    |

### **æ€»ä½“æ€§èƒ½è¯„çº§: B+ (è‰¯å¥½)**

**ä¼˜ç‚¹**: åŠŸèƒ½å®Œæ•´ã€é€»è¾‘æ¸…æ™°ã€æ¨¡å—åŒ–ç¨‹åº¦é«˜  
**æ”¹è¿›ç‚¹**: é™ä½å¾ªç¯é¢‘ç‡ã€ä¼˜åŒ– I/O æ“ä½œé¢‘ç‡ã€å‡å°‘å­—ç¬¦ä¸²å¤„ç†å¼€é”€

---

## ğŸ—ï¸ **ç³»ç»Ÿæ¶æ„æ¨¡å—åˆ†æ**

### **æ ¸å¿ƒæ¨¡å—ç»„æˆ**

1. **ç³»ç»Ÿåˆå§‹åŒ–æ¨¡å—** - ç¡¬ä»¶å¤–è®¾åˆå§‹åŒ–
2. **æŒ‰é”®æ§åˆ¶æ¨¡å—** - K1/K2/K3/K4 æŒ‰é”®å¤„ç†
3. **æ¸©æ¹¿åº¦ç›‘æµ‹æ¨¡å—** - HTU21D ä¼ æ„Ÿå™¨æ•°æ®é‡‡é›†
4. **é£æ‰‡è‡ªåŠ¨æ§åˆ¶æ¨¡å—** - åŸºäºæ¸©åº¦çš„æ™ºèƒ½è°ƒèŠ‚
5. **é£æ‰‡æ‰‹åŠ¨æ§åˆ¶æ¨¡å—** - ç”¨æˆ·æ‰‹åŠ¨æ¡£ä½è°ƒèŠ‚
6. **LCD æ˜¾ç¤ºæ¨¡å—** - ç”¨æˆ·ç•Œé¢æ˜¾ç¤º
7. **UART é€šä¿¡æ¨¡å—** - ä¸²å£å‘½ä»¤å’ŒçŠ¶æ€è¾“å‡º

### **æ¨¡å—é—´ä¾èµ–å…³ç³»**

```
åˆå§‹åŒ–æ¨¡å— â†’ æ‰€æœ‰å…¶ä»–æ¨¡å—
æŒ‰é”®æ§åˆ¶ â†’ é£æ‰‡æ§åˆ¶ + LCDæ˜¾ç¤º
æ¸©æ¹¿åº¦ç›‘æµ‹ â†’ è‡ªåŠ¨æ§åˆ¶ + LCDæ˜¾ç¤º
è‡ªåŠ¨/æ‰‹åŠ¨æ§åˆ¶ â†’ LCDæ˜¾ç¤º + PWMè¾“å‡º
UARTé€šä¿¡ â†’ æ¨¡å¼åˆ‡æ¢ + çŠ¶æ€è¾“å‡º
```

---

## ğŸ¯ **ä¼˜åŒ–å»ºè®®æ€»ç»“**

### **ç«‹å³å®æ–½**

1. è°ƒæ•´ä¸»å¾ªç¯å»¶æ—¶ä» 1ms åˆ° 10ms
2. å‡å°‘æŒ‰é”®é˜²æŠ–æ—¶é—´ä» 50ms åˆ° 10ms
3. é™ä½ LCD æ›´æ–°é¢‘ç‡åˆ° 500ms

### **ä¸­æœŸä¼˜åŒ–**

1. å®ç°ä¼ æ„Ÿå™¨æ•°æ®ç¼“å­˜æœºåˆ¶
2. é¢„è®¡ç®—å¸¸ç”¨å­—ç¬¦ä¸²çš„å±…ä¸­ä½ç½®
3. ä¼˜åŒ–çŠ¶æ€è¾“å‡ºé¢‘ç‡

### **é•¿æœŸæ”¹è¿›**

1. è€ƒè™‘ä½¿ç”¨ RTOS è¿›è¡Œä»»åŠ¡è°ƒåº¦
2. å®ç°ä½åŠŸè€—æ¨¡å¼
3. æ·»åŠ æ•°æ®è®°å½•å’Œåˆ†æåŠŸèƒ½

è¿™ä¸ªç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„æ¶æ„è®¾è®¡ï¼Œé€šè¿‡ä¸Šè¿°ä¼˜åŒ–å»ºè®®å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚
